{"title":"pthread","date":"2019-07-18T01:53:25.000Z","slug":"iOS-pthread","comments":true,"tags":["pthread"],"categories":["iOS"],"updated":"2019-07-18T02:31:07.000Z","content":"<h2 id=\"pthread\">pthread<a href=\"post/iOS-pthread#pthread\"></a></h2><p><code>pthread</code> 是 <code>POSIX threads</code> 的简称，是线程 <code>POSIX</code> 标准。该标准定义了穿件和操作线程的一整套 <code>API</code> ,在类 <code>Unix</code> 操作系统中，都使用 <code>pthread</code> 作为操作系统的线程。<code>Windows</code> 操作系统也有其移植版本。— 百度百科</p>\n<p><code>pthread</code> 这个方案在 <code>iOS</code> 中几乎不使用。<code>pthread</code> 是C语言实现的，在程序开发过程中需要我们手动管理内存。</p>\n<h3 id=\"pthread-的使用\">pthread 的使用<a href=\"post/iOS-pthread#pthread-的使用\"></a></h3><p>使用 <code>pthread</code> 需要导入头文件</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;pthread.h&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p><code>pthread_t</code> 用于标识一个线程，线程 <code>ID</code></p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> __darwin_pthread_t pthread_t;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">struct</span> _opaque_pthread_t *__darwin_pthread_t;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> _opaque_pthread_t &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> __sig;</span><br><span class=\"line\">\t<span class=\"keyword\">struct</span> __darwin_pthread_handler_rec  *__cleanup_stack;</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> __opaque[__PTHREAD_SIZE__];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><code>pthread_attr_t</code> 表示线程的属性</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> __darwin_pthread_attr_t pthread_attr_t;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">struct</span> _opaque_pthread_attr_t __darwin_pthread_attr_t;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> _opaque_pthread_attr_t &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> __sig;</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> __opaque[__PTHREAD_ATTR_SIZE__];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"常用API\">常用API<a href=\"post/iOS-pthread#常用API\"></a></h3><h4 id=\"pthread-create\">pthread_create<a href=\"post/iOS-pthread#pthread-create\"></a></h4><figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> pthread_create(pthread_t _Nullable * _Nonnull __restrict,</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> pthread_attr_t * _Nullable __restrict,</span><br><span class=\"line\">\t\t<span class=\"keyword\">void</span> * _Nullable (* _Nonnull)(<span class=\"keyword\">void</span> * _Nullable),</span><br><span class=\"line\">\t\t<span class=\"keyword\">void</span> * _Nullable __restrict);</span><br></pre></td></tr></table></figure>\n<p>创建线程，成功返回0，失败返回失败code</p>\n<ul>\n<li>第一个参数：指向线程标识的指针</li>\n<li>第二个参数：线程属性</li>\n<li>第三个参数：线程运行函数地址</li>\n<li>第四个参数：运行函数参数</li>\n</ul>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *params = <span class=\"string\">@\"参数\"</span>;</span><br><span class=\"line\">    pthread_t thread;</span><br><span class=\"line\">    pthread_create(&amp;thread, <span class=\"literal\">NULL</span>, task, (__bridge <span class=\"keyword\">void</span> *)(params));</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> *task(<span class=\"keyword\">void</span> *param) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"new thread : %@  参数是: %@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread], (__bridge <span class=\"built_in\">NSString</span> *)(param));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pthreadDemo[<span class=\"number\">39975</span>:<span class=\"number\">1768545</span>] new thread : &lt;<span class=\"built_in\">NSThread</span>: <span class=\"number\">0x600002777980</span>&gt;&#123;number = <span class=\"number\">3</span>, name = (null)&#125;  参数是: 参数</span><br></pre></td></tr></table></figure>\n","next":{"title":"多线程","slug":"iOS-多线程简介"},"link":"https://vesincc.github.io/post/iOS-pthread/","toc":[{"title":"pthread","id":"pthread","index":"1","children":[{"title":"pthread 的使用","id":"pthread-的使用","index":"1.1"},{"title":"常用API","id":"常用API","index":"1.2","children":[{"title":"pthread_create","id":"pthread-create","index":"1.2.1"}]}]}],"reward":true,"copyright":{"custom":"本文遵守 CC BY-NC-ND 4.0 请保持转载后文章内容的完整，以及文章出处。本人保留所有版权相关权利。"}}