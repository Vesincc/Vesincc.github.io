{"title":"Runtime(六) 可调试的objc4-750.1","date":"2019-05-24T03:06:48.000Z","slug":"iOS-runtime-node-6","comments":true,"tags":["Runtime"],"categories":["iOS"],"updated":"2019-07-10T03:35:32.000Z","content":"<h2 id=\"创建可调试的objc4-75-01工程\">创建可调试的<code>objc4-75.01</code>工程<a href=\"post/iOS-runtime-node-6#创建可调试的objc4-75-01工程\"></a></h2><h3 id=\"准备工作\">准备工作<a href=\"post/iOS-runtime-node-6#准备工作\"></a></h3><ul>\n<li>在<a href=\"https://opensource.apple.com/tarballs/\" target=\"_blank\" rel=\"noopener\">苹果开源网站</a>下载<a href=\"https://opensource.apple.com/tarballs/objc4/\" target=\"_blank\" rel=\"noopener\">objc4</a>最新的开源库，当前最新为<code>objc4-750.1</code></li>\n<li>dyld-551.3.tar.gz (新版的__API_AVAILABLE这个宏会报错)</li>\n<li>xnu-4903.221.2.tar.gz</li>\n<li>libdispatch-1008.220.2.tar.gz</li>\n<li>libplatform-177.200.16.tar.gz</li>\n<li>libpthread-330.220.2.tar.gz</li>\n</ul>\n<h3 id=\"报错及解决\">报错及解决<a href=\"post/iOS-runtime-node-6#报错及解决\"></a></h3><p>直接编译会遇到以下问题：</p>\n<h4 id=\"The-i386-architecture-is-deprecated-You-should-update-your-ARCHS-build-setting-to-remove-the-i386-architecture-in-target-‘objc’\">The i386 architecture is deprecated. You should update your ARCHS build setting to remove the i386 architecture. (in target ‘objc’)<a href=\"post/iOS-runtime-node-6#The-i386-architecture-is-deprecated-You-should-update-your-ARCHS-build-setting-to-remove-the-i386-architecture-in-target-‘objc’\"></a></h4><ol>\n<li>objc-&gt;TARGETS-&gt;objc-&gt;Build Settings-&gt;Architectures改为<code>Standard Archiectures</code></li>\n<li>objc-&gt;TARGETS-&gt;objc-trampolines-&gt;Build Settings-&gt;Architectures改为<code>Standard Archiectures</code></li>\n</ol>\n<h4 id=\"‘-h’-file-not-found\">‘*.h’ file not found<a href=\"post/iOS-runtime-node-6#‘-h’-file-not-found\"></a></h4><ol>\n<li><p>在工程项目目录中新建<code>include</code>文件夹，然后在工程的Build Settings -&gt; Search Paths -&gt; HeaderSearch Path 中添加 <code>$(SRCROOT)/include</code></p>\n<p> <img src=\"https://s2.ax1x.com/2019/05/24/ViaLB8.jpg\" alt></p>\n</li>\n<li><p>在<code>include</code>文件夹中按照报错新建文件目录并在准备工作过程中搜索对应头文件添加到该目录下</p>\n</li>\n</ol>\n<ul>\n<li><code>sys/reason.h</code> file not found 选择<code>./xnu-4903.221.2/bsd/sys/reason.h</code></li>\n<li><code>mach-o/dyld_priv.h</code> file not found 选择<code>./dyld-551.3/include/mach-o/dyld_priv.h</code></li>\n<li><code>os/lock_private.h</code> file not found 选择<code>./libplatform-177.200.16/private/os/lock_private.h</code></li>\n<li><code>os/base_private.h</code> file not found 选择<code>./libplatform-177.200.16/private/os/base_private.h</code></li>\n<li><code>pthread/tsd_private.h</code> file not found 选择<code>./libpthread-330.220.2/private/tsd_private.h</code></li>\n<li><code>System/machine/cpu_capabilities.h</code> file not found选择<code>./xnu-4903.221.2/osfmk/machine/cpu_capabilities.h</code></li>\n<li><code>os/tsd.h</code> file not found选择<code>./xnu-4903.221.2/libsyscall/os/tsd.h</code></li>\n<li><code>pthread/spinlock_private.h</code> file not found选择<code>./libpthread-330.220.2/private/spinlock_private.h</code></li>\n<li><code>System/pthread_machdep.h</code> file not found 这个不一样，直接把该处的头文件引用注释掉。</li>\n<li><code>CrashReporterClient.h</code> file not found 这个也要特殊处理。因为新版的LIBC库已经把这个头文件移除掉了。我们先把引用的到这个头文件地方注释掉。然后在objc-errors.mm搜索CRSetCrashLogMessage，把调用的地方都改为0，接着搜索CRSetCrashLogMessage，把调用的地方注释掉。</li>\n<li><code>Block_private.h</code> file not found 选择<code>./libdispatch-1008.220.2/src/BlocksRuntime/Block_private.h</code></li>\n<li><code>isa.h</code> file not found，这个去objc4的工程的runtime文件夹里面找到<code>isa.h</code>, 然后把它拖入工程。</li>\n<li><p><code>Use of undeclared identifier &#39;DYLD_MACOSX_VERSION_10_13&#39;</code>，这个需要打开刚刚拷贝过去的mach-o/dyld_priv.h，在里面加上</p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#define DYLD_MACOSX_VERSION_10_11 0x000A0B00</span><br><span class=\"line\">#define DYLD_MACOSX_VERSION_10_12 0x000A0C00</span><br><span class=\"line\">#define DYLD_MACOSX_VERSION_10_13 0x000A0D00</span><br><span class=\"line\">#define DYLD_MACOSX_VERSION_10_14 0x000A0E00</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>_simple.h</code> file not found 选择<code>./libplatform-177.200.16/private/_simple.h</code></p>\n</li>\n</ul>\n<p>最后<code>include</code>目录结构如下</p>\n<div class=\"article-img\"><p><img src=\"https://s2.ax1x.com/2019/05/24/ViysOA.jpg\" alt data-zoomable></p></div>\n<h4 id=\"Can’t-open-order-file-Applications-Xcode-app-Contents-Developer-Platforms-MacOSX-platform-Developer-SDKs-MacOSX10-14-sdk-AppleInternal-OrderFiles-libobjc-order\">Can’t open order file: /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/AppleInternal/OrderFiles/libobjc.order<a href=\"post/iOS-runtime-node-6#Can’t-open-order-file-Applications-Xcode-app-Contents-Developer-Platforms-MacOSX-platform-Developer-SDKs-MacOSX10-14-sdk-AppleInternal-OrderFiles-libobjc-order\"></a></h4><p>objc -&gt; Build Settings -&gt; Linking -&gt; Order File 改为<code>$(SRCROOT)/libobjc.order</code></p>\n<h4 id=\"Library-not-found-for-lCrashReporterClient\">Library not found for -lCrashReporterClient<a href=\"post/iOS-runtime-node-6#Library-not-found-for-lCrashReporterClient\"></a></h4><p>Build Settings -&gt; Linking -&gt; Other Linker Flags 删除<code>-lCrashReporterClient</code>(Debug、Release)</p>\n<h4 id=\"SDK-“macosx-internal”-cannot-be-located\">SDK “macosx.internal” cannot be located.<a href=\"post/iOS-runtime-node-6#SDK-“macosx-internal”-cannot-be-located\"></a></h4><p>Build Phases -&gt; Run Script(markgc) 中的 <code>macosx.internal</code> 改为 <code>macosx</code></p>\n<h4 id=\"no-such-public-header-file-‘-tmp-objc-dst-usr-include-objc-ObjectiveC-apinotes’\">no such public header file: ‘/tmp/objc.dst/usr/include/objc/ObjectiveC.apinotes’<a href=\"post/iOS-runtime-node-6#no-such-public-header-file-‘-tmp-objc-dst-usr-include-objc-ObjectiveC-apinotes’\"></a></h4><ol>\n<li>Build Settings -&gt; Test-Baseed API -&gt; Other Text-Based InstallAPI Flags 中内容全部删掉 </li>\n<li>Build Settings -&gt; Test-Baseed API -&gt; Text-Based InstallAPI Verification Model 改为 <code>Errors Only</code></li>\n</ol>\n<h3 id=\"编译通过\">编译通过<a href=\"post/iOS-runtime-node-6#编译通过\"></a></h3><h4 id=\"警告-Traditional-headermap-style-is-no-longer-supported-please-migrate-to-using-separate-headermaps-and-set-39-ALWAYS-SEARCH-USER-PATHS-39-to-NO-in-target-39-objc-trampolines-39-和-Traditional-headermap-style-is-no-longer-supported-please-migrate-to-using-separate-headermaps-and-set-39-ALWAYS-SEARCH-USER-PATHS-39-to-NO-in-target-39-objc-39\">警告 <code>Traditional headermap style is no longer supported; please migrate to using separate headermaps and set &#39;ALWAYS_SEARCH_USER_PATHS&#39; to NO. (in target &#39;objc-trampolines&#39;)</code> 和 <code>Traditional headermap style is no longer supported; please migrate to using separate headermaps and set &#39;ALWAYS_SEARCH_USER_PATHS&#39; to NO. (in target &#39;objc&#39;)</code><a href=\"post/iOS-runtime-node-6#警告-Traditional-headermap-style-is-no-longer-supported-please-migrate-to-using-separate-headermaps-and-set-39-ALWAYS-SEARCH-USER-PATHS-39-to-NO-in-target-39-objc-trampolines-39-和-Traditional-headermap-style-is-no-longer-supported-please-migrate-to-using-separate-headermaps-and-set-39-ALWAYS-SEARCH-USER-PATHS-39-to-NO-in-target-39-objc-39\"></a></h4><p>ojbc -&gt; TARGETS -&gt; objc -&gt; Build Settings -&gt; Search Paths -&gt; Always Search User Paths 设置为 <code>NO</code></p>\n<p>ojbc -&gt; TARGETS -&gt; objc-trampolines -&gt; Build Settings -&gt; Search Paths -&gt; Always Search User Paths 设置为 <code>NO</code></p>\n<h3 id=\"调试\">调试<a href=\"post/iOS-runtime-node-6#调试\"></a></h3><ol>\n<li>在项目下新建<code>Target</code></li>\n<li>为该<code>target</code>添加工程依赖</li>\n</ol>\n<div class=\"article-img\"><p><img src=\"https://s2.ax1x.com/2019/05/24/ViWmw9.md.jpg\" alt data-zoomable></p></div>\n<p><a href=\"https://github.com/Vesincc/objc4-750.1\" target=\"_blank\" rel=\"noopener\">已搭好的工程</a></p>\n","prev":{"title":"Runtime(七) Category","slug":"iOS-runtime-node-7"},"next":{"title":"Runtime(五) 加载过程","slug":"iOS-runtime-node-5"},"link":"https://vesincc.github.io/post/iOS-runtime-node-6/","toc":[{"title":"创建可调试的<code>objc4-75.01</code>工程","id":"创建可调试的objc4-75-01工程","index":"1","children":[{"title":"准备工作","id":"准备工作","index":"1.1"},{"title":"报错及解决","id":"报错及解决","index":"1.2","children":[{"title":"The i386 architecture is deprecated. You should update your ARCHS build setting to remove the i386 architecture. (in target ‘objc’)","id":"The-i386-architecture-is-deprecated-You-should-update-your-ARCHS-build-setting-to-remove-the-i386-architecture-in-target-‘objc’","index":"1.2.1"},{"title":"‘*.h’ file not found","id":"‘-h’-file-not-found","index":"1.2.2"},{"title":"Can’t open order file: /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/AppleInternal/OrderFiles/libobjc.order","id":"Can’t-open-order-file-Applications-Xcode-app-Contents-Developer-Platforms-MacOSX-platform-Developer-SDKs-MacOSX10-14-sdk-AppleInternal-OrderFiles-libobjc-order","index":"1.2.3"},{"title":"Library not found for -lCrashReporterClient","id":"Library-not-found-for-lCrashReporterClient","index":"1.2.4"},{"title":"SDK “macosx.internal” cannot be located.","id":"SDK-“macosx-internal”-cannot-be-located","index":"1.2.5"},{"title":"no such public header file: ‘/tmp/objc.dst/usr/include/objc/ObjectiveC.apinotes’","id":"no-such-public-header-file-‘-tmp-objc-dst-usr-include-objc-ObjectiveC-apinotes’","index":"1.2.6"}]},{"title":"编译通过","id":"编译通过","index":"1.3","children":[{"title":"警告 <code>Traditional headermap style is no longer supported; please migrate to using separate headermaps and set &#39;ALWAYS_SEARCH_USER_PATHS&#39; to NO. (in target &#39;objc-trampolines&#39;)</code> 和 <code>Traditional headermap style is no longer supported; please migrate to using separate headermaps and set &#39;ALWAYS_SEARCH_USER_PATHS&#39; to NO. (in target &#39;objc&#39;)</code>","id":"警告-Traditional-headermap-style-is-no-longer-supported-please-migrate-to-using-separate-headermaps-and-set-39-ALWAYS-SEARCH-USER-PATHS-39-to-NO-in-target-39-objc-trampolines-39-和-Traditional-headermap-style-is-no-longer-supported-please-migrate-to-using-separate-headermaps-and-set-39-ALWAYS-SEARCH-USER-PATHS-39-to-NO-in-target-39-objc-39","index":"1.3.1"}]},{"title":"调试","id":"调试","index":"1.4"}]}],"reward":true,"copyright":{"custom":"本文遵守 CC BY-NC-ND 4.0 请保持转载后文章内容的完整，以及文章出处。本人保留所有版权相关权利。"}}